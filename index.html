<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mac Portal Scanner</title>
<style>
:root{
  --bg:#0b1220;
  --card:#071625;
  --accent:#0ea5a4;
  --muted:#9fb3bf;
  --text:#e6eef8;
  --pill:#0f172a;
}

html,body{height:100%; margin:0; padding:12px; font-family:Inter, system-ui, monospace; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;}
.wrap{max-width:980px;margin:0 auto;}

header{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
h1{margin:0;font-size:1.3rem;}
.header-right{margin-left:auto;color:var(--muted);font-size:0.9rem;}

.card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.45);}

.controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
input[type=text]{flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:#03121a;color:var(--text);min-height:48px;font-size:16px;}
select,button{padding:11px 14px;border-radius:10px;border:0;background:var(--accent);color:#021014;font-weight:600;cursor:pointer;font-size:15px;min-height:48px;}
button.secondary{background:#64748b;color:#e6eef8;}

.status{font-size:0.95rem;color:var(--muted);margin-top:10px;}
.outwrap{display:flex;gap:12px;margin-top:12px;flex-direction:column;}
.output{background:#03121a;padding:12px;border-radius:8px;min-height:160px;overflow:auto;color:#cfe;box-shadow:inset 0 1px 0 rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);}
.output pre{white-space:pre-wrap;font-family:monospace;margin:0;}
.actions{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;}
.link{color:var(--accent);text-decoration:none;}
.iframe-wrap{width:100%;min-height:420px;background:#071018;border-radius:8px;overflow:auto;padding:6px;border:1px solid rgba(255,255,255,0.02);}
.small{font-size:0.85rem;color:var(--muted);}

@media (max-width:720px){
  .controls{flex-direction:column;align-items:stretch}
  input[type=text], select, button{width:100%!important;margin-left:0!important}
  .iframe-wrap{min-height:520px}
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>üîç Mac Portal Scanner</h1>
    <div class="header-right small">Worker Frontend</div>
  </header>

  <div class="card">
    <div class="controls">
      <input id="panel" type="text" inputmode="url" autocomplete="off"
             placeholder="Panel URL (z. B. http://host:8080/c/)">
      <select id="format" title="Ausgabeformat">
        <option value="html">HTML (Dashboard)</option>
        <option value="text">Plain Text</option>
        <option value="json">JSON (raw)</option>
      </select>
      <button id="scan">Scan</button>
      <button id="openNew" class="secondary" title="√ñffnet Ergebnis in neuem Tab">Open</button>
    </div>

    <div class="status small" id="status">Trage eine Panel URL ein und klicke ‚ÄπScan‚Ä∫.</div>

    <div class="outwrap">
      <div id="htmlContainer" class="iframe-wrap" style="display:none"></div>
      <div id="textContainer" class="output" style="display:none"><pre id="output"></pre></div>
      <div class="actions">
        <button id="copy" class="secondary">Kopieren</button>
        <button id="download" class="secondary">Herunterladen</button>
        <a id="openRaw" class="link" href="#" target="_blank" rel="noopener noreferrer" style="display:none">Direkt √∂ffnen</a>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const WORKER_URL = "https://morning-sea-adc4.elias256.workers.dev"; // <-- Worker URL

  const panelEl = document.getElementById('panel');
  const outEl = document.getElementById('output');
  const htmlContainer = document.getElementById('htmlContainer');
  const textContainer = document.getElementById('textContainer');
  const statusEl = document.getElementById('status');
  const formatEl = document.getElementById('format');
  const openNewBtn = document.getElementById('openNew');
  const copyBtn = document.getElementById('copy');
  const downloadBtn = document.getElementById('download');
  const openRaw = document.getElementById('openRaw');

  function setStatus(s, isError=false){
    statusEl.textContent = s;
    statusEl.style.color = isError ? '#ff7b7b' : '';
  }

  function buildWorkerFetchUrl(panel, format){
    return `${WORKER_URL}?panel=${encodeURIComponent(panel)}&format=${encodeURIComponent(format)}`;
  }

  async function scan(){
    const panel = panelEl.value.trim();
    if(!panel){ alert('Bitte eine Panel URL eingeben!'); return; }
    const fmt = formatEl.value;
    const url = buildWorkerFetchUrl(panel, fmt);
    setStatus('‚è≥ Scanne ‚Äî warte auf Antwort vom Worker ...');

    htmlContainer.style.display='none';
    textContainer.style.display='none';
    outEl.textContent='';
    openRaw.style.display='none';
    openRaw.href='#';

    try{
      const res = await fetch(url);
      if(!res.ok){
        let txt = await res.text().catch(()=>String(res.status));
        setStatus(`‚ùå Fehler: ${res.status} ‚Äî ${txt}`, true);
        return;
      }

      if(fmt==='html'){
        const html = await res.text();
        htmlContainer.innerHTML = html;
        htmlContainer.style.display='block';
        setStatus('‚úÖ Fertig ‚Äî Dashboard gerendert');
        openRaw.href = buildWorkerFetchUrl(panel,'html');
        openRaw.style.display='inline';
      } else if(fmt==='text'){
        const txt = await res.text();
        outEl.textContent = txt;
        textContainer.style.display='block';
        setStatus('‚úÖ Fertig ‚Äî Textausgabe');
        openRaw.href = buildWorkerFetchUrl(panel,'text');
        openRaw.style.display='inline';
      } else {
        const j = await res.json();
        outEl.textContent = JSON.stringify(j,null,2);
        textContainer.style.display='block';
        setStatus('‚úÖ Fertig ‚Äî JSON erhalten');
        openRaw.href = buildWorkerFetchUrl(panel,'json');
        openRaw.style.display='inline';
      }
    }catch(err){
      setStatus('‚ùå Fehler: '+(err.message||err),true);
    }
  }

  document.getElementById('scan').addEventListener('click', scan);
  panelEl.addEventListener('keydown', e=>{ if(e.key==='Enter') scan(); });

  openNewBtn.addEventListener('click', ()=>{
    const panel = panelEl.value.trim();
    if(!panel) return alert('Bitte eine Panel URL eingeben!');
    window.open(buildWorkerFetchUrl(panel,formatEl.value),'_blank','noopener');
  });

  copyBtn.addEventListener('click', async ()=>{
    const fmt=formatEl.value;
    let text='';
    if(fmt==='html') text=htmlContainer.innerHTML||'';
    else text=outEl.textContent||'';
    if(!text) return alert('Keine Ausgabe zum Kopieren vorhanden.');
    try{ await navigator.clipboard.writeText(text); setStatus('‚úÖ In die Zwischenablage kopiert'); }
    catch(e){ setStatus('‚ùå Kopieren fehlgeschlagen: '+(e.message||e),true); }
  });

  downloadBtn.addEventListener('click', ()=>{
    const fmt=formatEl.value;
    let content='',ext='txt';
    if(fmt==='html'){ content=htmlContainer.innerHTML||''; ext='html'; }
    else if(fmt==='json'){ content=outEl.textContent||''; ext='json'; }
    else{ content=outEl.textContent||''; ext='txt'; }

    if(!content) return alert('Keine Ausgabe zum Herunterladen vorhanden.');
    const blob = new Blob([content],{type:'text/plain;charset=utf-8'});
    const a =
